<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Console Admin — CV Viktor Morel</title>
  <style>body{visibility:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none}</style>
  <script>var _0x1=false;eval(atob('ZmV0Y2goJy8ubmV0bGlmeS9mdW5jdGlvbnMvYXBpL2FkbWluL2NoZWNrJyx7Y3JlZGVudGlhbHM6J2luY2x1ZGUnfSkudGhlbihyPT57aWYoIXIub2spdGhyb3cgbmV3IEVycm9yKCk7cmV0dXJuIHIuanNvbigpO30pLnRoZW4oZD0+e2lmKCFkLmlzQWRtaW4pd2luZG93LmxvY2F0aW9uLnJlcGxhY2UoJy8nKTtlbHNle18weDE9dHJ1ZTtkb2N1bWVudC5ib2R5LnN0eWxlLnZpc2liaWxpdHk9J3Zpc2libGUnO319KS5jYXRjaCgoKT0+d2luZG93LmxvY2F0aW9uLnJlcGxhY2UoJy8nKSk7'));document.addEventListener('contextmenu',e=>e.preventDefault());document.addEventListener('keydown',e=>{if(e.key==='F12'||(e.ctrlKey&&e.shiftKey&&(e.key==='I'||e.key==='J'||e.key==='C'))||(e.ctrlKey&&e.key==='u'))e.preventDefault();});</script>
  <link rel="stylesheet" href="/styles.css">
  <style>
    .admin-container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    .admin-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .admin-header h1 {
      color: #ffffff;
      margin-bottom: 8px;
      font-size: 2.2rem;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .admin-header p {
      color: rgba(255,255,255,0.85);
      font-size: 1.05rem;
    }
    .admin-section {
      background: rgba(255,255,255,0.98);
      border-radius: 20px;
      padding: 28px;
      margin-bottom: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.12);
      border: 1px solid rgba(255,255,255,0.5);
      backdrop-filter: blur(10px);
    }
    .admin-section h2 {
      color: #1f2430;
      margin: 0 0 24px;
      font-size: 1.4rem;
      border-bottom: 3px solid transparent;
      border-image: linear-gradient(90deg, #6a11cb, #2575fc) 1;
      padding-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      color: #5a6376;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #dfe3eb;
      border-radius: 8px;
      font-size: 1rem;
      color: #1f2430;
      box-sizing: border-box;
    }
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #6a11cb;
      box-shadow: 0 0 0 3px rgba(106,17,203,0.2);
    }
    .item-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px;
    }
    .item-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      background: linear-gradient(135deg, #f8f9fc 0%, #eef2ff 100%);
      border-radius: 12px;
      margin-bottom: 10px;
      border: 1px solid rgba(106,17,203,0.1);
      transition: all 0.25s ease;
    }
    .item-list li:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 15px rgba(106,17,203,0.1);
      border-color: rgba(106,17,203,0.2);
    }
    .item-list li span {
      color: #1f2430;
      font-weight: 500;
    }
    .btn-small {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-small:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .btn-edit {
      background: linear-gradient(135deg, #2575fc, #6a11cb);
      color: white;
    }
    .btn-edit:hover {
      box-shadow: 0 4px 15px rgba(37,117,252,0.4);
    }
    .btn-delete {
      background: linear-gradient(135deg, #ff4757, #ff6b81);
      color: white;
      margin-left: 8px;
    }
    .btn-delete:hover {
      box-shadow: 0 4px 15px rgba(255,71,87,0.4);
    }
    .btn-add {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      font-weight: 600;
      width: 100%;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-add:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(106,17,203,0.4);
    }
    .btn-save {
      background: linear-gradient(135deg, #3ddc97, #00b894);
      color: white;
      padding: 16px 32px;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      font-size: 1.15rem;
      font-weight: 700;
      width: 100%;
      margin-top: 24px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .btn-save:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(61,220,151,0.4);
    }
    .message {
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      display: none;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
      display: block;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
      display: block;
    }
    .admin-container {
      padding-top: 80px;
    }
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      justify-content: center;
      background: rgba(255,255,255,0.1);
      padding: 8px;
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }
    .tab-btn {
      padding: 12px 20px;
      border: none;
      background: transparent;
      color: rgba(255,255,255,0.8);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      font-weight: 500;
      font-size: 0.95rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .tab-btn:hover {
      background: rgba(255,255,255,0.15);
      color: white;
      transform: translateY(-2px);
    }
    .tab-btn.active {
      background: white;
      color: #6a11cb;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transform: translateY(-2px);
    }
    .tab-btn svg {
      width: 18px;
      height: 18px;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    /* Modal d'edition */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-overlay.active {
      display: flex;
    }
    .modal {
      background: white;
      border-radius: 16px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    .modal h3 {
      color: #1f2430;
      margin: 0 0 20px;
      font-size: 1.4rem;
    }
    .modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    .btn-cancel {
      background: #e0e0e0;
      color: #333;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      flex: 1;
    }
    .btn-confirm {
      background: linear-gradient(135deg, #6a11cb, #2575fc);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      flex: 1;
    }
    .btn-cancel:hover, .btn-confirm:hover {
      transform: translateY(-2px);
    }
    /* Navbar specifique pour admin */
    .navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
      z-index: 999;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body class="centered-layout">
  <!-- Navigation -->
  <nav class="navbar" role="navigation" aria-label="Navigation">
    <ul>
      <li><a href="/#about">À propos</a></li>
      <li><a href="/#experience">Expérience</a></li>
      <li><a href="/#skills">Compétences</a></li>
      <li><a href="/#projects">Centres d'intérêt</a></li>
      <li><a href="/#education">Formation</a></li>
      <li><a href="/#contact">Contact</a></li>
      <li><a href="/download-cv" class="nav-download">Télécharger CV</a></li>
    </ul>
    <div class="nav-actions">
      <a href="/" class="back-to-cv" style="color:white;text-decoration:none;padding:8px 16px;background:rgba(255,255,255,0.2);border-radius:8px;font-size:0.9rem;">← Retour au CV</a>
    </div>
  </nav>

  <div class="admin-container">
    <div class="admin-header">
      <h1>Console Administration</h1>
      <p style="color: rgba(255,255,255,0.8);">Modifier le contenu du CV en ligne</p>
    </div>

    <div id="message" class="message"></div>

    <!-- Stats rapides -->
    <div class="admin-section" style="margin-bottom:20px;">
      <div style="display:flex;gap:20px;flex-wrap:wrap;justify-content:center;">
        <div style="text-align:center;padding:15px 30px;background:linear-gradient(135deg,#6a11cb,#2575fc);border-radius:12px;color:white;">
          <div style="font-size:2rem;font-weight:700;" id="total-visits">-</div>
          <div style="font-size:0.85rem;opacity:0.9;">Visites totales</div>
        </div>
        <div style="text-align:center;padding:15px 30px;background:linear-gradient(135deg,#2575fc,#6a11cb);border-radius:12px;color:white;">
          <div style="font-size:2rem;font-weight:700;" id="today-visits">-</div>
          <div style="font-size:0.85rem;opacity:0.9;">Aujourd'hui</div>
        </div>
        <div style="text-align:center;padding:15px 30px;background:linear-gradient(135deg,#3ddc97,#00b894);border-radius:12px;color:white;">
          <div style="font-size:2rem;font-weight:700;" id="total-logins">-</div>
          <div style="font-size:0.85rem;opacity:0.9;">Connexions (15j)</div>
        </div>
      </div>
    </div>

    <div class="tabs">
      <button class="tab-btn active" onclick="showTab('skills')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
        Competences
      </button>
      <button class="tab-btn" onclick="showTab('interests')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        Interets
      </button>
      <button class="tab-btn" onclick="showTab('experience')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
        Experiences
      </button>
      <button class="tab-btn" onclick="showTab('contact')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        Contact
      </button>
      <button class="tab-btn" onclick="showTab('logins')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        Connexions
      </button>
    </div>

    <!-- Competences -->
    <div id="tab-skills" class="tab-content active">
      <div class="admin-section">
        <h2>Gerer les Competences</h2>
        <ul class="item-list" id="skills-list"></ul>
        <div class="form-group">
          <label>Nouvelle competence</label>
          <input type="text" id="new-skill" placeholder="Ex: Python, Reseaux, etc.">
        </div>
        <button class="btn-add" onclick="addSkill()">Ajouter une competence</button>
      </div>
    </div>

    <!-- Centres d'interet -->
    <div id="tab-interests" class="tab-content">
      <div class="admin-section">
        <h2>Gerer les Centres d'interet</h2>
        <ul class="item-list" id="interests-list"></ul>
        <div class="form-group">
          <label>Nouveau centre d'interet</label>
          <input type="text" id="new-interest" placeholder="Ex: Sport, Musique, etc.">
        </div>
        <button class="btn-add" onclick="addInterest()">Ajouter un centre d'interet</button>
      </div>
    </div>

    <!-- Experiences -->
    <div id="tab-experience" class="tab-content">
      <div class="admin-section">
        <h2>Gerer les Experiences</h2>
        <ul class="item-list" id="experience-list"></ul>
        <div class="form-group">
          <label>Titre du poste/stage</label>
          <input type="text" id="exp-title" placeholder="Ex: Stage developpeur">
        </div>
        <div class="form-group">
          <label>Entreprise</label>
          <input type="text" id="exp-company" placeholder="Ex: France Televisions">
        </div>
        <div class="form-group">
          <label>Tag/Categorie</label>
          <input type="text" id="exp-tag" placeholder="Ex: Audiovisuel">
        </div>
        <div class="form-group">
          <label>Date</label>
          <input type="text" id="exp-date" placeholder="Ex: Janvier 2025">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="exp-description" placeholder="Description du poste..."></textarea>
        </div>
        <button class="btn-add" onclick="addExperience()">Ajouter une experience</button>
      </div>
    </div>

    <!-- Contact -->
    <div id="tab-contact" class="tab-content">
      <div class="admin-section">
        <h2>Informations de Contact</h2>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="contact-email" placeholder="votre@email.com">
        </div>
        <div class="form-group">
          <label>Telephone</label>
          <input type="tel" id="contact-phone" placeholder="06.XX.XX.XX.XX">
        </div>
        <div class="form-group">
          <label>LinkedIn</label>
          <input type="text" id="contact-linkedin" placeholder="Votre profil LinkedIn">
        </div>
      </div>
    </div>

    <!-- Connexions -->
    <div id="tab-logins" class="tab-content">
      <div class="admin-section">
        <h2>Historique des Connexions</h2>
        <p style="color:#5a6376;margin-bottom:16px;">Liste des utilisateurs qui se sont connectes via Google OAuth</p>
        <div id="logins-list" style="max-height:400px;overflow-y:auto;">
          <p style="color:#888;">Chargement...</p>
        </div>
        <button class="btn-add" onclick="loadLogins()" style="margin-top:16px;background:linear-gradient(135deg,#2575fc,#6a11cb);">Actualiser</button>
      </div>
    </div>

    <button class="btn-save" onclick="saveAll()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
      Sauvegarder les modifications
    </button>
  </div>

  <!-- Modal d'edition -->
  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <h3 id="modalTitle">Modifier</h3>
      <div id="modalContent"></div>
      <div class="modal-actions">
        <button class="btn-cancel" onclick="closeModal()">Annuler</button>
        <button class="btn-confirm" onclick="confirmEdit()">Enregistrer</button>
      </div>
    </div>
  </div>

  <script>
    // Donnees du site (chargees depuis le serveur)
    let siteData = {
      skills: [],
      interests: [],
      experiences: [],
      contact: {
        email: '',
        phone: '',
        linkedin: ''
      }
    };

    // Charger les donnees au demarrage
    async function loadData() {
      try {
        const response = await fetch('/api/admin/data');
        if (response.ok) {
          siteData = await response.json();
          renderAll();
        }
      } catch (err) {
        console.error('Erreur chargement:', err);
      }
    }

    // Afficher les donnees
    function renderAll() {
      renderSkills();
      renderInterests();
      renderExperiences();
      renderContact();
    }

    function renderSkills() {
      const list = document.getElementById('skills-list');
      list.innerHTML = siteData.skills.map((skill, i) => `
        <li>
          <span>${skill}</span>
          <div>
            <button class="btn-small btn-edit" onclick="editSkill(${i})">Modifier</button>
            <button class="btn-small btn-delete" onclick="deleteSkill(${i})">Supprimer</button>
          </div>
        </li>
      `).join('');
    }

    function renderInterests() {
      const list = document.getElementById('interests-list');
      list.innerHTML = siteData.interests.map((interest, i) => `
        <li>
          <span>${interest}</span>
          <div>
            <button class="btn-small btn-edit" onclick="editInterest(${i})">Modifier</button>
            <button class="btn-small btn-delete" onclick="deleteInterest(${i})">Supprimer</button>
          </div>
        </li>
      `).join('');
    }

    function renderExperiences() {
      const list = document.getElementById('experience-list');
      list.innerHTML = siteData.experiences.map((exp, i) => `
        <li>
          <span><strong>${exp.title}</strong> - ${exp.company}</span>
          <div>
            <button class="btn-small btn-edit" onclick="editExperience(${i})">Modifier</button>
            <button class="btn-small btn-delete" onclick="deleteExperience(${i})">Supprimer</button>
          </div>
        </li>
      `).join('');
    }

    function renderContact() {
      document.getElementById('contact-email').value = siteData.contact.email || '';
      document.getElementById('contact-phone').value = siteData.contact.phone || '';
      document.getElementById('contact-linkedin').value = siteData.contact.linkedin || '';
    }

    // Ajouter des elements
    function addSkill() {
      const input = document.getElementById('new-skill');
      if (input.value.trim()) {
        siteData.skills.push(input.value.trim());
        input.value = '';
        renderSkills();
      }
    }

    function addInterest() {
      const input = document.getElementById('new-interest');
      if (input.value.trim()) {
        siteData.interests.push(input.value.trim());
        input.value = '';
        renderInterests();
      }
    }

    function addExperience() {
      const title = document.getElementById('exp-title').value.trim();
      const company = document.getElementById('exp-company').value.trim();
      const tag = document.getElementById('exp-tag').value.trim();
      const date = document.getElementById('exp-date').value.trim();
      const description = document.getElementById('exp-description').value.trim();

      if (title && company) {
        siteData.experiences.push({ title, company, tag, date, description });
        document.getElementById('exp-title').value = '';
        document.getElementById('exp-company').value = '';
        document.getElementById('exp-tag').value = '';
        document.getElementById('exp-date').value = '';
        document.getElementById('exp-description').value = '';
        renderExperiences();
      }
    }

    // Supprimer des elements
    function deleteSkill(index) {
      siteData.skills.splice(index, 1);
      renderSkills();
    }

    function deleteInterest(index) {
      siteData.interests.splice(index, 1);
      renderInterests();
    }

    function deleteExperience(index) {
      siteData.experiences.splice(index, 1);
      renderExperiences();
    }

    // Modal d'edition
    let currentEditType = null;
    let currentEditIndex = null;

    function openModal(title, content) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalContent').innerHTML = content;
      document.getElementById('editModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('editModal').classList.remove('active');
      currentEditType = null;
      currentEditIndex = null;
    }

    function editSkill(index) {
      currentEditType = 'skill';
      currentEditIndex = index;
      const skill = siteData.skills[index];
      openModal('Modifier la competence', `
        <div class="form-group">
          <label>Competence</label>
          <input type="text" id="edit-skill" value="${skill}" placeholder="Ex: Python, Reseaux, etc.">
        </div>
      `);
    }

    function editInterest(index) {
      currentEditType = 'interest';
      currentEditIndex = index;
      const interest = siteData.interests[index];
      openModal("Modifier le centre d'interet", `
        <div class="form-group">
          <label>Centre d'interet</label>
          <input type="text" id="edit-interest" value="${interest}" placeholder="Ex: Sport, Musique, etc.">
        </div>
      `);
    }

    function editExperience(index) {
      currentEditType = 'experience';
      currentEditIndex = index;
      const exp = siteData.experiences[index];
      openModal("Modifier l'experience", `
        <div class="form-group">
          <label>Titre du poste/stage</label>
          <input type="text" id="edit-exp-title" value="${exp.title || ''}" placeholder="Ex: Stage developpeur">
        </div>
        <div class="form-group">
          <label>Entreprise</label>
          <input type="text" id="edit-exp-company" value="${exp.company || ''}" placeholder="Ex: France Televisions">
        </div>
        <div class="form-group">
          <label>Tag/Categorie</label>
          <input type="text" id="edit-exp-tag" value="${exp.tag || ''}" placeholder="Ex: Audiovisuel">
        </div>
        <div class="form-group">
          <label>Date</label>
          <input type="text" id="edit-exp-date" value="${exp.date || ''}" placeholder="Ex: Janvier 2025">
        </div>
        <div class="form-group">
          <label>Description</label>
          <textarea id="edit-exp-description" placeholder="Description du poste...">${exp.description || ''}</textarea>
        </div>
      `);
    }

    function confirmEdit() {
      if (currentEditType === 'skill') {
        const newValue = document.getElementById('edit-skill').value.trim();
        if (newValue) {
          siteData.skills[currentEditIndex] = newValue;
          renderSkills();
        }
      } else if (currentEditType === 'interest') {
        const newValue = document.getElementById('edit-interest').value.trim();
        if (newValue) {
          siteData.interests[currentEditIndex] = newValue;
          renderInterests();
        }
      } else if (currentEditType === 'experience') {
        const title = document.getElementById('edit-exp-title').value.trim();
        const company = document.getElementById('edit-exp-company').value.trim();
        const tag = document.getElementById('edit-exp-tag').value.trim();
        const date = document.getElementById('edit-exp-date').value.trim();
        const description = document.getElementById('edit-exp-description').value.trim();
        if (title && company) {
          siteData.experiences[currentEditIndex] = { title, company, tag, date, description };
          renderExperiences();
        }
      }
      closeModal();
    }

    // Fermer le modal en cliquant a l'exterieur
    document.getElementById('editModal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    // Sauvegarder
    async function saveAll() {
      // Recuperer les infos de contact
      siteData.contact.email = document.getElementById('contact-email').value.trim();
      siteData.contact.phone = document.getElementById('contact-phone').value.trim();
      siteData.contact.linkedin = document.getElementById('contact-linkedin').value.trim();

      try {
        const response = await fetch('/api/admin/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(siteData)
        });

        const messageEl = document.getElementById('message');
        if (response.ok) {
          messageEl.textContent = 'Modifications sauvegardees avec succes !';
          messageEl.className = 'message success';
        } else {
          messageEl.textContent = 'Erreur lors de la sauvegarde.';
          messageEl.className = 'message error';
        }

        setTimeout(() => {
          messageEl.className = 'message';
        }, 3000);
      } catch (err) {
        console.error('Erreur sauvegarde:', err);
      }
    }

    // Gestion des onglets
    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
      event.target.classList.add('active');
    }

    // Charger les stats
    async function loadStats() {
      try {
        const response = await fetch('/api/admin/stats');
        if (response.ok) {
          const stats = await response.json();
          document.getElementById('total-visits').textContent = stats.visits || 0;
          const today = new Date().toISOString().split('T')[0];
          const todayStats = stats.lastVisits?.find(v => v.date === today);
          document.getElementById('today-visits').textContent = todayStats?.count || 0;
        } else {
          document.getElementById('total-visits').textContent = 0;
          document.getElementById('today-visits').textContent = 0;
        }
      } catch (err) {
        console.error('Erreur chargement stats:', err);
        document.getElementById('total-visits').textContent = 0;
        document.getElementById('today-visits').textContent = 0;
      }
    }

    // Charger les connexions avec compteur
    async function loadLogins() {
      const container = document.getElementById('logins-list');
      container.innerHTML = '<p style="color:#888;">Chargement...</p>';
      try {
        const response = await fetch('/api/admin/logins');
        if (response.ok) {
          const logins = await response.json();
          document.getElementById('total-logins').textContent = logins.length;
          if (logins.length === 0) {
            container.innerHTML = '<p style="color:#888;">Aucune connexion enregistree.</p>';
          } else {
            container.innerHTML = '<ul class="item-list">' + logins.map(login => `
              <li style="flex-direction:column;align-items:flex-start;gap:4px;padding:12px;">
                <div style="display:flex;align-items:center;gap:10px;width:100%;flex-wrap:wrap;">
                  ${login.photo ? `<img src="${login.photo}" alt="" style="width:36px;height:36px;border-radius:50%;">` : ''}
                  <div style="flex:1;min-width:200px;">
                    <strong style="color:#1f2430;">${login.name || 'Utilisateur'}</strong>
                    <span style="color:#5a6376;font-size:0.9rem;margin-left:8px;">${login.email || ''}</span>
                  </div>
                  <small style="color:#888;white-space:nowrap;">${login.date ? new Date(login.date).toLocaleString('fr-FR') : ''}</small>
                </div>
              </li>
            `).join('') + '</ul>';
          }
        } else if (response.status === 403) {
          document.getElementById('total-logins').textContent = '-';
          container.innerHTML = '<p style="color:#888;">Connectez-vous en admin pour voir les connexions.</p>';
        } else {
          document.getElementById('total-logins').textContent = 0;
          container.innerHTML = '<p style="color:#ff4757;">Erreur lors du chargement.</p>';
        }
      } catch (err) {
        console.error('Erreur chargement connexions:', err);
        document.getElementById('total-logins').textContent = 0;
        container.innerHTML = '<p style="color:#ff4757;">Erreur reseau.</p>';
      }
    }

    // Init
    eval(atob('aWYodHlwZW9mIF8weDEhPT0ndW5kZWZpbmVkJyl7dmFyIF8weDI9c2V0SW50ZXJ2YWwoZnVuY3Rpb24oKXtpZihfMHgxKXtjbGVhckludGVydmFsKF8weDIpO2xvYWREYXRhKCk7bG9hZExvZ2lucygpO2xvYWRTdGF0cygpO319LDUwKTt9'));
  </script>
</body>
</html>
